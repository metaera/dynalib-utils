<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Dynalib Utils: Dynalib Utils</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Dynalib Utils
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Dynalib Utils </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><ul><li class="level2"><a href="#autotoc_md2">Requirements</a><ul><li class="level3"><a href="#autotoc_md3">Docker</a></li>
<li class="level3"><a href="#autotoc_md4">Ubuntu 18.04 LTS</a></li>
<li class="level3"><a href="#autotoc_md5">macOS</a></li>
<li class="level3"><a href="#autotoc_md6">CentOS 7</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md7">Build</a><ul><li class="level3"><a href="#autotoc_md8">GCC</a></li>
<li class="level3"><a href="#autotoc_md9">Clang</a></li>
<li class="level3"><a href="#autotoc_md10">Treat warnings as errors</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md11">Run</a><ul><li class="level3"><a href="#autotoc_md12">Application</a></li>
<li class="level3"><a href="#autotoc_md13">Unit tests</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md14">Build Docs</a></li>
<li class="level2"><a href="#autotoc_md15">Clang Tools</a><ul><li class="level3"><a href="#autotoc_md16">Clang Static Analyzer</a></li>
<li class="level3"><a href="#autotoc_md17">Clang-Tidy</a></li>
<li class="level3"><a href="#autotoc_md18">AddressSanitizer</a></li>
<li class="level3"><a href="#autotoc_md19">UndefinedBehaviourSanitizer</a></li>
<li class="level3"><a href="#autotoc_md20">Clang Code Coverage</a></li>
<li class="level3"><a href="#autotoc_md21">Clang-Format</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md22">Cppcheck</a></li>
</ul>
</ul>
</div>
<div class="textblock"><table class="doxtable">
<tr>
<th>Build Status </th><th></th></tr>
<tr>
<td>Github Actions </td><td><div class="image">
<object type="image/svg+xml" data="https://github.com/metaera/dynalib-utils/workflows/build-release/badge.svg" alt="build-release"></object>
</div>
 </td></tr>
<tr>
<td>Coverage Reports </td><td><a href="https://coveralls.io/github/metaera/dynalib-utils?branch=master"></a> </td></tr>
<tr>
<td>Docs </td><td><a href="https://metaera.github.io/dynalib-utils/">https://metaera.github.io/dynalib-utils/</a> </td></tr>
</table>
<p>Example C++11 <a href="https://cmake.org/">CMake</a> project that incorporates awesome <a href="https://clang.llvm.org/">Clang</a> tooling, such as sanitizers, a code formatter, and code coverage reporting.</p>
<p>This repository is designed to be used as an example of how to set up a C++ project to use Clang tooling as well as be a template that can be copied and modified. Care has been taken to follow established C++ conventions whenever possible.</p>
<p>For more information about Clang, see the <a href="https://github.com/ingve/awesome-clang">awesome-clang</a> repository.</p>
<p>For C++ coding guidelines, see the <a href="https://github.com/isocpp/CppCoreGuidelines">C++ Core Guidelines</a>.</p>
<p>You can use docker container to build code in this project on all OS's</p>
<p>You can run a container and map project code into directory to do all build processes.</p>
<div class="fragment"><div class="line">docker run -it --rm -v `pwd`:/build -w /build gvfn/clang-buildpack:ubuntu-10 bash</div></div><!-- fragment --><p>Install required packages.</p>
<blockquote class="doxtable">
<p>On Ubuntu 16.04 LTS, omit the <code>clang-tools</code> package, which is included in the <code>clang</code> package on Ubuntu 16.04 LTS. </p>
</blockquote>
<div class="fragment"><div class="line">$ sudo apt install gcc g++ clang clang-tidy clang-tools clang-format cmake cppcheck doxygen graphviz</div></div><!-- fragment --><blockquote class="doxtable">
<p>Set alternatives for tools use for test coverage. </p>
</blockquote>
<div class="fragment"><div class="line">sudo update-alternatives --install /usr/local/bin/llvm-profdata llvm-profdata /usr/lib/llvm-10/bin/llvm-profdata 20</div><div class="line">sudo update-alternatives --install /usr/local/bin/llvm-cov llvm-cov /usr/lib/llvm-10/bin/llvm-cov 20</div></div><!-- fragment --><p>Install <a href="https://brew.sh/">Homebrew</a></p>
<p>Install required packages</p>
<div class="fragment"><div class="line">$ brew install llvm clang-format cmake cppcheck doxygen graphviz</div></div><!-- fragment --><p>The <code>llvm</code> formula is not installed into the user's <code>PATH</code> by default because it shadows tools such as <code>clang</code> that Apple provide. In order to use <code>clang-tidy</code> and LLVM code coverage tools, we need those in the <code>PATH</code> when <code>cmake</code> runs.</p>
<div class="fragment"><div class="line">$ echo &#39;export PATH=&quot;/usr/local/opt/llvm/bin:$PATH&quot;&#39; &gt;&gt; ~/.bash_profile</div></div><!-- fragment --><p>First install the <a href="https://fedoraproject.org/wiki/EPEL">EPEL</a> repository.</p>
<div class="fragment"><div class="line">$ sudo yum install epel-release</div></div><!-- fragment --><p>Next install the <a href="https://wiki.centos.org/AdditionalResources/Repositories/SCL">SCL</a> repository.</p>
<div class="fragment"><div class="line">$ sudo yum install centos-release-scl</div></div><!-- fragment --><p>Install required packages</p>
<div class="fragment"><div class="line">$ sudo yum install gcc gcc-c++ llvm-toolset-7 llvm-toolset-7-clang-tools-extra cmake3 cppcheck doxygen graphviz</div></div><!-- fragment --><p>Append <code>-DCMAKE_BUILD_TYPE=Release</code> or <code>-DCMAKE_BUILD_TYPE=Debug</code> to the <code>cmake</code> command arguments to specify release or debug builds.</p>
<div class="fragment"><div class="line">$ cd build</div><div class="line">$ cmake ..</div><div class="line">$ make</div></div><!-- fragment --><p>**Note: On CentOS 7, replace the <code>cmake</code> command with <code>scl enable llvm-toolset-7 'cmake3 -DCMAKE_CXX_COMPILER=clang++ ..'</code>.**</p>
<div class="fragment"><div class="line">$ cd build</div><div class="line">$ cmake -DCMAKE_CXX_COMPILER=clang++ ..</div><div class="line">$ make</div></div><!-- fragment --><p>Use <code>-DWERROR=On</code> option to treat compile warnings as errors.</p>
<div class="fragment"><div class="line">$ cd build</div><div class="line">$ cmake -DWERROR=On ..</div><div class="line">$ make</div><div class="line">/home/user/GitHub/clang-blueprint/src/danger/bad_examples.cpp:13:18: error: array index</div><div class="line">      3 is past the end of the array (which contains 2 elements)</div><div class="line">      [-Werror,-Warray-bounds]</div><div class="line">    std::cout &lt;&lt; a[3];</div><div class="line">                 ^ ~</div><div class="line">...</div></div><!-- fragment --><p>First, perform a build as described in the <b>Build</b> section, then run the following commands in the <code>build</code> directory.</p>
<div class="fragment"><div class="line">$ ./clang-blueprint</div></div><!-- fragment --><p>Unit tests are written using the <a href="https://github.com/catchorg/Catch2/">Catch2</a> unit testing framework.</p>
<div class="fragment"><div class="line">$ ./UnitTests</div></div><!-- fragment --><p>Documentation is built using <a href="http://www.doxygen.org/">Doxygen</a>. To configure how the docs are built, modify <a href="docs/Doxyfile"><code>docs/Doxyfile</code></a>.</p>
<div class="fragment"><div class="line">$ cd docs</div><div class="line">$ doxygen</div><div class="line">$ firefox html/index.html</div></div><!-- fragment --><div class="image">
<img src="images/doxygen.png" alt="Doxygen Documentation"/>
</div>
<p>**Note: On CentOS 7 for all of the following Clang tool instructions, replace the <code>cmake</code> command with <code>scl enable llvm-toolset-7 'cmake3 &lt;OPTIONS&gt; ..'</code>.**</p>
<p>The <a href="https://clang-analyzer.llvm.org/">Clang Static Analyzer</a> finds bugs in C/C++ programs at compile time.</p>
<p><b>Note: Not available on CentOS 7.</b></p>
<div class="fragment"><div class="line">$ cd build</div><div class="line"># On Ubuntu 18.04, use the specific scan-build-6.0 command.</div><div class="line">$ scan-build cmake ..</div><div class="line">$ scan-build make</div><div class="line">...</div><div class="line">scan-build: 2 bugs found.</div><div class="line">scan-build: Run &#39;scan-view /var/folders/...&#39; to examine bug reports.</div><div class="line"></div><div class="line"># Run the scan-view command printed in the build output to view the report.</div><div class="line"># On Ubuntu 18.04, use the specific scan-view-6.0 command.</div><div class="line">$ scan-view /var/folders/...</div></div><!-- fragment --><div class="image">
<img src="images/clang_static_analyzer_1.png" alt="Clang Static Analyzer Report"/>
</div>
<div class="image">
<img src="images/clang_static_analyzer_2.png" alt="Clang Static Analyzer Report"/>
</div>
<p><a href="http://clang.llvm.org/extra/clang-tidy/">Clang-Tidy</a> is configured using the <a href=".clang-tidy"><code>.clang-tidy</code></a> configuration file. Modify this file to control which checks should be run and configure parameters for certain checks.</p>
<p>For real projects, you'll likely want to modify this configuration file and disable certain checks you feel are too pedantic or don't match your project needs.</p>
<div class="fragment"><div class="line">$ cd build</div><div class="line">$ cmake ..</div><div class="line">$ make clang-tidy</div><div class="line">Scanning dependencies of target clang-tidy</div><div class="line">95 warnings generated.</div><div class="line">7477 warnings generated.</div><div class="line">/home/user/GitHub/clang-blueprint/src/main.cpp:10:28: warning: </div><div class="line">    parameter &#39;argc&#39; is unused [misc-unused-parameters]</div><div class="line">int32_t main(const int32_t argc, const char* argv[]) {</div><div class="line">                           ^~~~~</div><div class="line">                            /*argc*/</div><div class="line">/home/user/GitHub/clang-blueprint/src/main.</div><div class="line">...</div></div><!-- fragment --><p><a href="https://clang.llvm.org/docs/AddressSanitizer.html">AddressSanitizer</a> is a fast memory error detector. It consists of a compiler instrumentation module and a run-time library. The tool can detect the following types of bugs:</p>
<ul>
<li>Out-of-bounds accesses to heap, stack and globals</li>
<li>Use-after-free</li>
<li>Use-after-return</li>
<li>Use-after-scope</li>
<li>Double-free, invalid free</li>
<li>Memory leaks</li>
</ul>
<p>It is similar in functionality to Valgrind, but runs much faster and is able to catch a wider variety of bugs.</p>
<div class="fragment"><div class="line">$ cd build</div><div class="line">$ cmake -DCMAKE_BUILD_TYPE=Debug -DCMAKE_CXX_COMPILER=clang++ -DADDRESS_SANITIZER=On ..</div><div class="line">$ make</div><div class="line">$ ./UnitTests</div><div class="line">==25797==ERROR: AddressSanitizer: heap-use-after-free on address 0x61400000024c at </div><div class="line">pc 0x000000616ecf bp 0x7ffd7aab4b30 sp 0x7ffd7aab4b28</div><div class="line">...</div></div><!-- fragment --><p>The <a href="https://clang.llvm.org/docs/UndefinedBehaviorSanitizer.html">UndefinedBehaviourSanitizer</a> modifies the program at compile-time to catch various kinds of undefined behavior during program execution, for example:</p>
<ul>
<li>Using misaligned or null pointer</li>
<li>Signed integer overflow</li>
<li>Conversion to, from, or between floating-point types which would overflow the destination</li>
</ul>
<div class="fragment"><div class="line">$ cd build</div><div class="line">$ cmake -DCMAKE_BUILD_TYPE=Debug -DCMAKE_CXX_COMPILER=clang++ -DUNDEFINED_SANITIZER=On ..</div><div class="line">$ make</div><div class="line">$ ./UnitTests</div><div class="line">/home/user/GitHub/clang-blueprint/test/danger/test_bad_examples.cpp:17:7: </div><div class="line">runtime error: signed integer overflow: 2147483647 + 1 cannot be represented in type &#39;int&#39;</div><div class="line">...</div></div><!-- fragment --><p><a href="https://clang.llvm.org/docs/SourceBasedCodeCoverage.html">Clang source-based code coverage</a> provides metrics on which lines are covered by tests.</p>
<div class="fragment"><div class="line">$ cd build</div><div class="line">$ cmake -DCMAKE_BUILD_TYPE=Debug -DCMAKE_CXX_COMPILER=clang++ -DCLANG_CODE_COVERAGE=On ..</div><div class="line">$ make</div><div class="line">$ ./UnitTests</div><div class="line"></div><div class="line"># On Ubuntu 18.04, use the specific llvm-profdata-6.0 command.</div><div class="line">$ llvm-profdata merge -sparse default.profraw -o default.profdata</div><div class="line"># On Ubuntu 18.04, use the specific llvm-cov-6.0 command.</div><div class="line">$ llvm-cov show -format=html -o coverage ./UnitTests -instr-profile=default.profdata</div><div class="line"></div><div class="line"># View the coverage report.</div><div class="line">$ firefox coverage/index.html</div></div><!-- fragment --><div class="image">
<img src="images/coverage_report.png" alt="Coverage Report"/>
</div>
<p><a href="https://clang.llvm.org/docs/ClangFormat.html">Clang-Format</a> is a tool that can automically format your source code accordiing to a specific style guide, saving developers time. It is configured using the <a href=".clang-format"><code>.clang-format</code></a> configuration file. Modify this file to control how source files should be formatted.</p>
<p>To demonstrate <code>clang-format</code> in action, first modify a line from <a href="src/main.cpp"><code>src/main.cpp</code></a></p>
<div class="fragment"><div class="line"><span class="keywordflow">return</span> EXIT_SUCCESS;</div></div><!-- fragment --><p>To</p>
<div class="fragment"><div class="line"><span class="keywordflow">return</span>           EXIT_SUCCESS;</div></div><!-- fragment --><p>Next, run <code>clang-format</code> on the project.</p>
<div class="fragment"><div class="line">$ cd build</div><div class="line">$ cmake ..</div><div class="line">$ make clang-format</div></div><!-- fragment --><p><a href="src/main.cpp"><code>src/main.cpp</code></a> will be reformatted properly to</p>
<div class="fragment"><div class="line"><span class="keywordflow">return</span> EXIT_SUCCESS;</div></div><!-- fragment --><p><a href="http://cppcheck.sourceforge.net/">Cppcheck</a> is a static analysis tool for C/C++ code. To run on the project</p>
<div class="fragment"><div class="line">$ cd build</div><div class="line">$ cmake ..</div><div class="line">$ make cppcheck</div><div class="line">[/home/user/GitHub/clang-blueprint/src/main.cpp:14]: (error) Array &#39;a[2]&#39; accessed at index 3, </div><div class="line">    which is out of bounds.</div><div class="line">...</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
